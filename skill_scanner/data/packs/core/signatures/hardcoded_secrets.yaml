# Hardcoded Secrets & Credential Leak Signatures
# Detects API keys, tokens, private keys, passwords, and connection strings

- id: SECRET_AWS_KEY
  category: hardcoded_secrets
  severity: CRITICAL
  patterns:
    - "(?:AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}"
  exclude_patterns:
    # AWS official example keys from documentation
    - "AKIAIOSFODNN7EXAMPLE"
    - "AKIAI44QH8DHBEXAMPLE"
    - "EXAMPLEKEYID"
    - "example"
    - "Example"
    - "EXAMPLE"
    - "placeholder"
    - "test_key"
    - "fake"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "AWS access key detected"
  remediation: "Remove hardcoded AWS keys. Use environment variables or IAM roles"

- id: SECRET_STRIPE_KEY
  category: hardcoded_secrets
  severity: CRITICAL
  patterns:
    - "(?:sk|pk)_(?:live|test)_[A-Za-z0-9]{24,}"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "Stripe API key detected"
  remediation: "Remove hardcoded Stripe keys. Use environment variables"

- id: SECRET_GOOGLE_API
  category: hardcoded_secrets
  severity: CRITICAL
  patterns:
    - "AIza[A-Za-z0-9_-]{35}"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "Google API key detected"
  remediation: "Remove hardcoded Google API keys"

- id: SECRET_GITHUB_TOKEN
  category: hardcoded_secrets
  severity: CRITICAL
  patterns:
    - "gh[pousr]_[A-Za-z0-9]{36,}"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "GitHub token detected"
  remediation: "Remove hardcoded GitHub tokens"

- id: SECRET_JWT_TOKEN
  category: hardcoded_secrets
  severity: HIGH
  patterns:
    - "eyJ[A-Za-z0-9_-]+\\.eyJ[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "JWT token detected"
  remediation: "Remove hardcoded JWT tokens"

- id: SECRET_PRIVATE_KEY
  category: hardcoded_secrets
  severity: CRITICAL
  patterns:
    # Require a full key block (BEGIN + body + END) to avoid docs that only
    # list header markers as examples.
    - "-----BEGIN (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----\\n(?:[A-Za-z0-9+/=]{20,}\\n){2,}-----END (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----"
  exclude_patterns:
    # Example/test/documentation keys
    - "example"
    - "Example"
    - "test"
    - "Test"
    - "demo"
    - "Demo"
    - "sample"
    - "Sample"
    - "fake"
    - "placeholder"
    - "open.?source.?check"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "Private key block detected"
  remediation: "Remove hardcoded private keys"

- id: SECRET_PASSWORD_VAR
  category: hardcoded_secrets
  severity: MEDIUM
  patterns:
    - "(?:password|passwd|pwd)\\s*=\\s*['\\\"][^'\\\"]{8,}['\\\"]"
    - "(?:api_key|apikey|api-key)\\s*=\\s*['\\\"][^'\\\"]{16,}['\\\"]"
    - "(?:secret|token)\\s*=\\s*['\\\"][^'\\\"]{16,}['\\\"]"
  file_types: [python, bash, javascript, typescript]
  description: "Hardcoded password or secret in variable"
  remediation: "Use environment variables or secure vaults for secrets"

- id: SECRET_CONNECTION_STRING
  category: hardcoded_secrets
  severity: HIGH
  patterns:
    - "(?:mongodb|mysql|postgresql|postgres)://[^:]+:[^@]+@"
  exclude_patterns:
    # Example/placeholder connection strings
    - "user:pass@host"
    - "user:password@"
    - "username:password@"
    - "admin:admin@"
    - "root:root@"
    - "test:test@"
    - "example"
    - "Example"
    - "EXAMPLE"
    - "localhost"
    - "placeholder"
    - "<password>"
    - "\\$\\{.*\\}"
    - "%.*%"
    # Documentation patterns - connection string format examples
    - "your[-_]?password"
    - "your[-_]?user"
    - "myuser"
    - "mypassword"
    - "mydb"
    - "dbuser"
    - "dbpass"
    - "user:pass@"
    - "user:pass@db"
    - "user:pass@database"
    - "user:pass@example"
    - "username:password@db"
    # Passwords supplied via env vars are not hardcoded secrets
    - "(?:mongodb|mysql|postgresql|postgres)://[^:@]+:\\$[A-Za-z_][A-Za-z0-9_]*@"
    - "secret123"
    - "password123"
    - "devuser:devpass@"
    - "airflow:airflow@"
    - "agenta:agenta_password@"
    # Grep/search patterns used by security scanners
    - "grep"
    - "rg\\s"
    - "egrep"
    - "fgrep"
    - "findstr"
    # Regex/templates used in security docs and rule references
    - "://\\.\\*:\\.\\*@\\.\\*"
    - "://\\[\\^:\\]\\+:\\[\\^@\\]\\+@\\[\\^/\\]\\+"
    # Inside code blocks (markdown documentation)
    - "```"
  file_types: [python, bash, markdown, javascript, typescript]
  description: "Database connection string with embedded credentials"
  remediation: "Remove credentials from connection strings"
