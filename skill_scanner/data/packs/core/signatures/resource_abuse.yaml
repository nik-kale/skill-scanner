# Resource Abuse & Denial of Service Signatures
# Detects infinite loops, fork bombs, and excessive memory allocation

- id: RESOURCE_ABUSE_INFINITE_LOOP
  category: resource_abuse
  severity: HIGH
  patterns:
    - "while\\s+True\\s*:"
    - "while\\s+1\\s*:"
    - "for\\s+\\w+\\s+in\\s+itertools\\.count\\s*\\("
  exclude_patterns:
    - "except\\s+(EOFError|StopIteration|KeyboardInterrupt|Exception)\\s*:"
    - "break"
    - "return"
    - "sys\\.exit"
    - "raise\\s+StopIteration"
  file_types: [python]
  description: "Infinite loop without clear exit condition"
  remediation: "Add proper exit conditions or limits to loops"

- id: RESOURCE_ABUSE_FORK_BOMB
  category: resource_abuse
  severity: CRITICAL
  patterns:
    - ":\\(\\)\\{\\s*:\\|:\\s*&\\s*\\}\\s*;\\s*:"
    - "os\\.fork\\s*\\(\\s*\\).*while"
  file_types: [bash, python]
  description: "Fork bomb pattern detected"
  remediation: "Remove fork bomb code"

- id: RESOURCE_ABUSE_LARGE_ALLOCATION
  category: resource_abuse
  severity: HIGH
  patterns:
    - "\\[.*\\]\\s*\\*\\s*(?:[1-9][0-9]{6,})"
    - "bytearray\\s*\\(\\s*(?:[1-9][0-9]{7,})"
  file_types: [python]
  description: "Very large memory allocation"
  remediation: "Limit memory allocation. Process data in chunks"
